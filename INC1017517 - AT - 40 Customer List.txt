INC1017517 - FW: AT-40 Customer list_CX
-----------------------------------------------------------------------------------------------------------------------------------------------

SELECT DISTINCT
    hp.party_name           customer_name,
    hcs.cust_account_id     customer_account_id,
    hca.account_number      customer_account_number,
    hca.account_name        customeraccountname,
    hcs.cust_acct_site_id   customer_account_site_id,
    decode(hcs.bill_to_flag, 'P', 'P', 'Y', 'Y',
           hcs.bill_to_flag) cust_acct_bill_to_flag,
    decode(hcs.ship_to_flag, 'P', 'P', 'Y', 'Y',
           hcs.ship_to_flag) cust_acct_ship_to_flag,
    hcs.status              cust_acct_acnt_site_status,
    hou.name                operating_unit,
    hl.address1             address1,
    hl.address2             address2,
    hl.address3             address3,
    hl.address3             address4,
    hl.city                 city,
    hl.state                state,
    hl.postal_code          postalcode,
    hl.county               county,
    hl.province             province,
    hl.country              country,
    (
        SELECT
            ph.phone_number
        FROM
            apps.ar_phones_v ph
        WHERE
            ph.owner_table_name = 'HZ_PARTY_SITES'
            AND ph.owner_table_id = hcs.party_site_id
            AND ph.contact_point_type = 'PHONE'
            AND ph.phone_type = 'GEN'
            AND ph.primary_flag = 'Y'
            AND ph.status = 'A'
-- AND rownum = 1
    ) phone_number,
    hp.person_first_name    contact_fisrt_name,
    hp.person_last_name     contact_last_name,
    (
        SELECT
            email_address
        FROM
            apps.hz_contact_points hcp1
        WHERE
            hcp1.owner_table_name = 'HZ_PARTY_SITES'
            AND hcp1.owner_table_id = hps.party_site_id
            AND hcp1.contact_point_type = 'EMAIL'
            AND ROWNUM = 1
    ) email,
    hp.party_number         customeracctsitenumber,
    hl.location_id          locationnumber,

    hca.status              customeraccountstatus,
    hps.party_site_number   customeracctsitenumber
FROM
    apps.hz_locations             hl,
    apps.hz_party_sites           hps,
    apps.hz_cust_acct_sites_all   hcs,
    apps.hz_cust_accounts         hca,
    apps.hz_cust_site_uses_all    hus,
    apps.hz_parties               hp,
    apps.hr_operating_units       hou,
    apps.hz_customer_profiles     hcp,
    apps.oe_order_headers_all     oeha
WHERE
    hl.location_id = hps.location_id
    AND hps.party_site_id = hcs.party_site_id
    AND hca.cust_account_id = hcs.cust_account_id
    AND hca.account_name = 'AFTERMARKET'
    AND hca.party_id = hp.party_id
    AND hp.party_id = hcp.party_id
    AND hca.cust_account_id = hcp.cust_account_id
    AND hcs.cust_acct_site_id = hus.cust_acct_site_id
    AND hp.party_id = hps.party_id
    AND oeha.sold_to_org_id = hca.cust_account_id
    AND hca.status = 'A'
    AND hp.status = 'A'
    AND hcs.status = 'A'
    AND hou.organization_id = oeha.org_id
    AND hus.org_id = hou.organization_id
    --AND hca.cust_account_id = 7838268
    AND hou.organization_id IN (
      14474
    );
